# 分析問題並提供解決方案
analysis = {
    "問題1": {
        "描述": "重採樣失敗導致多時框特徵缺失",
        "影響": "只有單一 15m 時框的 125 個技術指標，缺乏 1h/4h/1d 的趨勢信息",
        "解決": "修復 resample_ohlcv 方法的頻率提取邏輯"
    },
    "問題2": {
        "描述": "Layer1 參數聯動機制設計不當", 
        "影響": "lag 參數偏移範圍過窄，限制了標籤生成的靈活性",
        "解決": "擴大 Layer1 聯動的搜索範圍，如 lag=15 → 範圍[10, 20]而不是[12, 18]"
    },
    "問題3": {
        "描述": "特徵選擇策略問題",
        "影響": "342 個特徵中有效特徵比例低，噪聲特徵影響模型性能", 
        "解決": "增加特徵質量過濾，如相關性分析、重要性排序"
    },
    "問題4": {
        "描述": "標籤不平衡問題嚴重",
        "影響": "從日誌看標籤分布為 {0: 37175, 1: 41643, 2: 26304}，類別2明顯偏少",
        "解決": "調整 profit/loss quantile 的搜索範圍，平衡三類標籤分布"
    }
}

print("=== Layer2 分數偏低的根本原因分析 ===\n")
for problem, details in analysis.items():
    print(f"{problem}: {details['描述']}")
    print(f"  影響: {details['影響']}")
    print(f"  解決: {details['解決']}\n")

# 提供優化建議
suggestions = [
    "1. 立即修復 resample_ohlcv 方法，確保多時框特徵正常生成",
    "2. 調整 Layer1 聯動參數範圍，增加搜索靈活性",
    "3. 在特徵生成後增加特徵質量評估和過濾",
    "4. 優化標籤生成的 quantile 範圍，改善類別平衡",
    "5. 考慮減少初始特徵數量，專注於高質量特徵的組合"
]

print("=== 優化建議 ===")
for suggestion in suggestions:
    print(suggestion)